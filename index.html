<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | ExamPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeInUp 0.3s ease; }
        .nav-btn.active { background: #4f46e5; color: white; border-color: #6366f1; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">
    <aside class="w-full md:w-72 bg-slate-900 border-r border-white/5 flex flex-col p-6 shrink-0 z-50">
        <h2 class="text-2xl font-black text-indigo-500 italic mb-10">ADMIN<span class="text-white">PRO</span></h2>
        <nav class="flex flex-row md:flex-col gap-2 overflow-x-auto">
            <button onclick="switchTab('tab-cat', this)" class="nav-btn active p-4 rounded-2xl text-left flex items-center gap-3 whitespace-nowrap"><i class="fa-solid fa-folder-tree"></i> Categories</button>
            <button onclick="switchTab('tab-add', this)" class="nav-btn p-4 rounded-2xl text-left flex items-center gap-3 text-slate-400 whitespace-nowrap"><i class="fa-solid fa-plus-circle"></i> Add/Edit Series</button>
            <button onclick="switchTab('tab-manage', this)" class="nav-btn p-4 rounded-2xl text-left flex items-center gap-3 text-slate-400 whitespace-nowrap"><i class="fa-solid fa-layer-group"></i> Live Series</button>
            <button onclick="switchTab('tab-slider', this)" class="nav-btn p-4 rounded-2xl text-left flex items-center gap-3 text-slate-400 whitespace-nowrap"><i class="fa-solid fa-images"></i> App Slider</button>
            <button onclick="switchTab('tab-pages', this)" class="nav-btn p-4 rounded-2xl text-left flex items-center gap-3 text-slate-400 whitespace-nowrap"><i class="fa-solid fa-file-pen"></i> Pages & Content</button>
        </nav>
    </aside>

    <main class="flex-1 p-6 md:p-12 overflow-y-auto">
        <!-- Categories Tab -->
        <div id="tab-cat" class="tab-content active">
            <h1 class="text-3xl font-bold mb-8">Categories</h1>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                <div class="bg-slate-800 p-8 rounded-[2rem] border border-white/5">
                    <input id="cat-input" type="text" placeholder="SSC, Police..." class="w-full bg-slate-900 p-4 rounded-2xl mb-4 outline-none ring-1 ring-white/10">
                    <button onclick="addCategory()" class="w-full bg-indigo-600 py-4 rounded-2xl font-bold hover:bg-indigo-500 transition">Add Category</button>
                </div>
                <div id="cat-display-list" class="space-y-3"></div>
            </div>
        </div>

        <!-- Add/Edit Tab -->
        <div id="tab-add" class="tab-content">
            <h1 id="form-heading" class="text-3xl font-bold mb-8">Publish New Series</h1>
            <div class="bg-slate-800 p-8 rounded-[2.5rem] border border-white/5 max-w-4xl">
                <input type="hidden" id="edit-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <input id="s-title" type="text" placeholder="Series Title" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-white/5">
                    <input id="s-price" type="number" placeholder="Price (INR)" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-white/5">
                    <input id="s-duration" type="number" placeholder="Duration (Minutes)" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-yellow-500">
                    <input id="s-pos" type="number" step="0.1" placeholder="Marks per Q" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-indigo-500">
                    <input id="s-ratio" type="number" placeholder="Neg Ratio" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-red-500">
                    <select id="s-cat-select" class="w-full bg-slate-900 p-4 rounded-2xl ring-1 ring-white/5"></select>
                    <div onclick="document.getElementById('img-file').click()" class="bg-slate-900 p-4 rounded-2xl text-center border-2 border-dashed border-white/10 cursor-pointer">
                        <input type="file" id="img-file" hidden accept="image/*" onchange="previewThumbnail(event)">
                        <span id="img-placeholder">Upload Thumbnail</span>
                        <img id="img-preview-box" class="hidden w-full h-32 object-cover rounded-xl">
                    </div>
                </div>

                <div class="bg-slate-900 p-4 rounded-2xl border border-dashed border-indigo-500/30 mb-4">
                    <h6 class="text-indigo-400 text-xs font-bold uppercase mb-2">Image Code Tool</h6>
                    <div class="flex gap-4 items-center">
                        <input type="file" id="q-img-input" accept="image/*" class="text-xs text-slate-400" onchange="convertQImage()">
                        <input type="text" id="q-img-output" placeholder="Code here..." class="flex-1 bg-black/20 p-2 rounded text-xs text-indigo-300 outline-none" readonly onclick="this.select(); document.execCommand('copy'); Swal.fire('Copied!', 'Paste in JSON', 'success')">
                    </div>
                </div>

                <label class="text-xs text-indigo-400 font-bold mb-2 block uppercase">Questions JSON (Paste Multiple Tests Here)</label>
                <!-- PLACEHOLDER UPDATED TO SHOW MULTI-TEST & DATE LOCK FORMAT -->
                <textarea id="s-json" rows="12" placeholder='[
  { 
    "name": "Test 1: History Special", 
    "duration": 60,
    "questions": [ ...Questions Array... ] 
  },
  { 
    "name": "Test 2: Math (Scheduled)", 
    "unlockDate": "2026-05-20T10:30:00", 
    "duration": 45,
    "questions": [ ...Questions Array... ] 
  }
]' class="w-full bg-slate-900 p-5 rounded-3xl outline-none font-mono text-xs mb-6 text-green-400"></textarea>
                <button onclick="publishSeries()" class="w-full bg-green-600 py-5 rounded-[2rem] font-black uppercase">Publish Live</button>
            </div>
        </div>

        <!-- Manage Tab -->
        <div id="tab-manage" class="tab-content">
            <h1 class="text-3xl font-bold mb-8">Manage Live Series</h1>
            <div id="live-series-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

        <!-- Slider Tab -->
        <div id="tab-slider" class="tab-content">
            <h1 class="text-3xl font-bold mb-8">App Home Slider</h1>
            <div class="bg-slate-800 p-8 rounded-[2rem] border border-white/5 mb-8">
                <div class="flex gap-4 items-center">
                    <input type="file" id="slider-input" accept="image/*" class="text-sm text-slate-400">
                    <button onclick="uploadSliderImage()" class="bg-indigo-600 px-6 py-2 rounded-xl font-bold">Upload Slide</button>
                </div>
            </div>
            <div id="slider-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>

        <!-- Pages Tab -->
        <div id="tab-pages" class="tab-content">
            <h1 class="text-3xl font-bold mb-8">App Pages Content</h1>
            <div class="bg-slate-800 p-8 rounded-[2rem] border border-white/5 max-w-4xl">
                <div class="mb-6">
                    <label class="block mb-2 text-indigo-400 font-bold">Select Page</label>
                    <select id="page-selector" onchange="loadPageContent()" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-white/10">
                        <option value="privacy">Privacy Policy</option>
                        <option value="about">About Us</option>
                    </select>
                </div>
                <div class="mb-6">
                    <textarea id="page-content" rows="10" class="w-full bg-slate-900 p-5 rounded-2xl outline-none ring-1 ring-white/5 font-mono"></textarea>
                </div>
                <button onclick="savePageContent()" class="w-full bg-indigo-600 py-4 rounded-2xl font-bold hover:bg-indigo-500 transition">Save Page Data</button>
            </div>
        </div>
    </main>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAhg7hKJ123JRAfio7fymK543XpuNonMHo", databaseURL: "https://showpdf-ffa34-default-rtdb.firebaseio.com", projectId: "showpdf-ffa34" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let base64Image = "";

        function switchTab(id, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
            if(id !== 'tab-add') resetForm();
            if(id === 'tab-pages') loadPageContent();
        }

        function addCategory() {
            const val = document.getElementById('cat-input').value.trim();
            if(val) db.ref('categories').push(val).then(() => document.getElementById('cat-input').value = "");
        }

        db.ref('categories').on('value', snap => {
            const list = document.getElementById('cat-display-list');
            const select = document.getElementById('s-cat-select');
            list.innerHTML = ""; select.innerHTML = "";
            snap.forEach(c => {
                list.innerHTML += `<div class="bg-slate-800 p-4 rounded-2xl flex justify-between"><span>${c.val()}</span><button onclick="db.ref('categories/${c.key}').remove()">Delete</button></div>`;
                select.innerHTML += `<option value="${c.val()}">${c.val()}</option>`;
            });
        });

        function previewThumbnail(e) {
            const reader = new FileReader();
            reader.onload = () => { base64Image = reader.result; document.getElementById('img-preview-box').src = base64Image; document.getElementById('img-preview-box').classList.remove('hidden'); document.getElementById('img-placeholder').classList.add('hidden'); };
            reader.readAsDataURL(e.target.files[0]);
        }

        function convertQImage() {
            const file = document.getElementById('q-img-input').files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = () => { document.getElementById('q-img-output').value = reader.result; };
            reader.readAsDataURL(file);
        }

        function publishSeries() {
            const id = document.getElementById('edit-id').value;
            const jsonVal = document.getElementById('s-json').value;

            try {
                const parsed = JSON.parse(jsonVal);
                if (!Array.isArray(parsed)) throw new Error("JSON must be array");
            } catch (e) {
                return Swal.fire('Invalid JSON', 'Please paste valid JSON inside [] brackets', 'error');
            }

            const data = {
                title: document.getElementById('s-title').value,
                price: document.getElementById('s-price').value,
                duration: document.getElementById('s-duration').value || 60,
                posMarks: document.getElementById('s-pos').value || 1,
                negRatio: document.getElementById('s-ratio').value || 3,
                cat: document.getElementById('s-cat-select').value,
                questions: jsonVal,
                image: base64Image
            };
            const ref = id ? db.ref('testSeries/' + id) : db.ref('testSeries').push();
            ref.set(data).then(() => { Swal.fire('Success', 'Published!', 'success'); switchTab('tab-manage', document.querySelectorAll('.nav-btn')[2]); });
        }

        db.ref('testSeries').on('value', snap => {
            const grid = document.getElementById('live-series-grid'); grid.innerHTML = "";
            snap.forEach(c => {
                const s = c.val();
                let cNum = 0; try { cNum = JSON.parse(s.questions).length } catch(e){}
                grid.innerHTML += `<div class="bg-slate-800 p-5 rounded-[2rem] border border-white/5 shadow-xl"><img src="${s.image}" class="w-full h-32 object-cover rounded-2xl mb-4"><h4>${s.title}</h4><p class="text-xs text-indigo-400 mt-2">${cNum} Sets</p><div class="flex gap-2 mt-4"><button onclick="editSeries('${c.key}')" class="flex-1 bg-indigo-600 py-2 rounded-xl">Edit</button><button onclick="db.ref('testSeries/${c.key}').remove()" class="bg-red-500 px-4 rounded-xl">Del</button></div></div>`;
            });
        });

        function editSeries(id) {
            db.ref('testSeries/' + id).once('value', snap => {
                const s = snap.val();
                document.getElementById('edit-id').value = id;
                document.getElementById('s-title').value = s.title;
                document.getElementById('s-price').value = s.price;
                document.getElementById('s-duration').value = s.duration || 60;
                document.getElementById('s-pos').value = s.posMarks;
                document.getElementById('s-ratio').value = s.negRatio;
                document.getElementById('s-json').value = s.questions;
                base64Image = s.image;
                document.getElementById('img-preview-box').src = s.image;
                document.getElementById('img-preview-box').classList.remove('hidden');
                document.getElementById('img-placeholder').classList.add('hidden');
                switchTab('tab-add', document.querySelectorAll('.nav-btn')[1]);
                document.getElementById('form-heading').innerText = "Edit Series";
            });
        }

        function resetForm() { document.getElementById('edit-id').value = ""; document.getElementById('s-json').value=""; document.getElementById('img-preview-box').classList.add('hidden'); document.getElementById('img-placeholder').classList.remove('hidden'); base64Image = ""; }

        function uploadSliderImage() {
            const file = document.getElementById('slider-input').files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                db.ref('appSlider').push({ image: reader.result }).then(() => {
                    Swal.fire('Success', 'Slide Added', 'success');
                    document.getElementById('slider-input').value = "";
                });
            };
            reader.readAsDataURL(file);
        }

        db.ref('appSlider').on('value', snap => {
            const grid = document.getElementById('slider-grid');
            grid.innerHTML = "";
            snap.forEach(c => {
                grid.innerHTML += `<div class="bg-slate-800 p-3 rounded-xl border border-white/5"><img src="${c.val().image}" class="w-full h-32 object-cover rounded-lg mb-3"><button onclick="db.ref('appSlider/${c.key}').remove()" class="w-full bg-red-500 py-2 rounded-lg text-sm font-bold">Delete Slide</button></div>`;
            });
        });

        function loadPageContent() {
            const page = document.getElementById('page-selector').value;
            db.ref('appPages/' + page).once('value', snap => {
                document.getElementById('page-content').value = snap.val() || "";
            });
        }
        function savePageContent() {
            const page = document.getElementById('page-selector').value;
            const content = document.getElementById('page-content').value;
            db.ref('appPages/' + page).set(content).then(() => Swal.fire('Saved!', 'Updated', 'success'));
        }
    </script>
</body>
</html>
